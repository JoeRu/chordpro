<?xml version="1.0" encoding="UTF-8"?>
<implementation-plan>
  <metadata>
    <title>ChordPro Feature and Bug Plan (Migrated)</title>
    <version>2.0</version>
    <date>2026-02-08</date>
    <status>Full code analysis (2026-02-08)</status>
    <summary>
      Full code analysis completed. Codebase is Perl 5.26+ with Object::Pad backends, a
      parse -> transform -> render pipeline, JSON config hierarchy, and Template::Toolkit
      templates for HTML5 and LaTeX. Docs are built with Hugo in docs/.
    </summary>
  </metadata>

  <items>
    <item id="7" type="feature" status="PENDING" priority="MEDIUM" complexity="M">
      <title>Markdown Backend Feature Completeness</title>
      <justification><![CDATA[
Source: ai-docs/feature-bugs.xml item 7 (branch: Backends).
Markdown.pm is a modern backend but may lack chord diagrams, keyboard diagrams, image embedding,
delegate rendering, and volta bracket representation. A complete Markdown backend improves
documentation and publishing use cases.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="7.1"><![CDATA[Audit Markdown.pm for missing element handlers vs ChordProBase.]]></task>
        <task id="7.2"><![CDATA[Add chord diagram rendering (ASCII or reference link pattern).]]></task>
        <task id="7.3"><![CDATA[Add delegate result embedding (as images or SVG blocks).]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/73_md.t</file>
            <description>Extend markdown tests to cover all element types.</description>
            <assertions>Correct markdown syntax for all elements and delegates.</assertions>
          </test>
          <test type="human">
            <file></file>
            <description>Generate markdown from a full-featured .cho file and validate in a renderer.</description>
            <assertions>Readable output with diagrams and delegates represented.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="17" type="feature" status="PENDING" priority="LOW" complexity="M">
      <title>API and Configuration Documentation</title>
      <justification><![CDATA[
Source: ai-docs/feature-bugs.xml item 17 (branch: Documentation).
HTML5 configuration (html5.mode, html5.templates, html5.paged.*) and backend selection via
{format}.module lack user-facing documentation. Docs exist in docs/ but HTML5 sections are sparse.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="17.1"><![CDATA[Document HTML5 backend configuration in docs/content/.]]></task>
        <task id="17.2"><![CDATA[Document backend selection via {format}.module for end users.]]></task>
        <task id="17.3"><![CDATA[Add examples for print mode, chord diagrams, section labels, and grids.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="human">
            <file></file>
            <description>Build docs site and verify HTML5 sections render correctly.</description>
            <assertions>Docs include HTML5 config, examples, and backend selection notes.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="48" type="bug" status="PENDING" priority="MEDIUM" complexity="S">
      <title>Lyrics-Only Verse Spacing in HTML5</title>
      <justification><![CDATA[
Source: ai-docs/bugs.xml bug 6.
If a verse has no chords, HTML5 still renders chord placeholders that reserve vertical space.
Lyrics-only lines should not allocate chord spacing.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="48.1"><![CDATA[Track whether a songline has any chords and render a lyrics-only span when none exist.]]></task>
        <task id="48.2"><![CDATA[Update HTML5 songline template to skip chord placeholders for lyrics-only lines.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/190_html5_bug6_lyrics_only.t</file>
            <description>Verify lyrics-only lines do not include chord placeholders.</description>
            <assertions>Lyrics-only lines render without reserved chord row space.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="49" type="bug" status="PENDING" priority="HIGH" complexity="S">
      <title>Image Scale Uses Page Width in HTML5</title>
      <justification><![CDATA[
Source: ai-docs/bugs.xml bug 7.
When image scale is provided, HTML5 should scale relative to page/container width,
matching PDF behavior.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="49.1"><![CDATA[Apply scale factor as CSS width percentage when scale is provided.]]></task>
        <task id="49.2"><![CDATA[Ensure delegate SVG outputs scale correctly when scale is used.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/191_html5_image_scale.t</file>
            <description>Verify scale=0.5 yields width: 50% in HTML5 output.</description>
            <assertions>Image has CSS width percentage matching scale value.</assertions>
          </test>
        </tests>
      </verification>
    </item>
  </items>

  <archive>
    <item id="1" type="bug" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Image Scale Relative to Page Width (HTML5)</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 1.]]></justification>
      <r>
        <outcome>DONE</outcome>
        <observations><![CDATA[Implemented scale-as-percentage for HTML5 images and added regression coverage.]]></observations>
        <lessons-learned><![CDATA[Apply scaling in both template-based images and direct render_image paths.]]></lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>lib/ChordPro/res/templates/html5/image.tt</file>
          <file>t/191_html5_image_scale.t</file>
        </files>
      </r>
    </item>

    <item id="2" type="refactoring" status="DENIED" priority="MEDIUM" complexity="L" archived="2026-02-08">
      <title>Legacy Backend Migration to Object::Pad</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 2. Deferred; PDF backend too large and other backends are lower priority.]]></justification>
    </item>

    <item id="3" type="tech-debt" status="DENIED" priority="LOW" complexity="L" archived="2026-02-08">
      <title>Song.pm Parser Decomposition</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 3. Deferred due to high regression risk.]]></justification>
    </item>

    <item id="4" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>Legacy HTML Backend Feature Gap</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 4. HTML5 supersedes legacy HTML backend.]]></justification>
    </item>

    <item id="5" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Text Backend Feature Gaps</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 5. Deferred until backend migration.]]></justification>
    </item>

    <item id="6" type="tech-debt" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>TODO/FIXME Cleanup in Production Code</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 6. Deferred; investigate markers individually when touched.]]></justification>
    </item>

    <item id="8" type="tech-debt" status="DENIED" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Test Coverage for Underserved Backends</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 8. Deferred due to scope and limited immediate need.]]></justification>
    </item>

    <item id="9" type="bug" status="DENIED" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Roman Numeral Chord Notation - Parser Gaps</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 9. Deferred; existing tests pass, potential edge cases noted.]]></justification>
    </item>

    <item id="10" type="bug" status="DENIED" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Debug Warnings in Production Delegate Code</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 10. Deferred; requires GUI and delegate adjustments.]]></justification>
    </item>

    <item id="11" type="tech-debt" status="DENIED" priority="MEDIUM" complexity="L" archived="2026-02-08">
      <title>PDF Backend Incomplete Code Paths</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 11. Deferred due to PDF backend complexity.]]></justification>
    </item>

    <item id="12" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Config Validation and Error Reporting</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 12. Deferred; restricted hash errors remain a known pitfall.]]></justification>
    </item>

    <item id="13" type="feature" status="DONE" priority="CRITICAL" complexity="L" archived="2026-02-08">
      <title>HTML5 Print Mode - Feature Parity with PDF (Completed)</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 13.]]></justification>
      <r>
        <outcome>DONE</outcome>
        <observations><![CDATA[HTML5 print parity achieved with comprehensive template and backend updates and extensive tests.]]></observations>
        <lessons-learned><![CDATA[Restricted hash handling and dashed TT keys are common pitfalls.]]></lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>lib/ChordPro/res/templates/html5/</file>
          <file>t/html5/</file>
          <file>t/html5paged/</file>
        </files>
      </r>
    </item>

    <item id="14" type="bug" status="DONE" priority="HIGH" complexity="M" archived="2026-02-08">
      <title>HTML5 Backend Bug Fixes 1-6 (Completed)</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 14.]]></justification>
      <r>
        <outcome>DONE</outcome>
        <observations><![CDATA[Fixed chord alignment, image handling, delegate rendering, entity escaping, and lyrics-only spacing with tests.]]></observations>
        <lessons-learned><![CDATA[Visibility hidden preserves chord spacing; avoid double-escaping in TT templates.]]></lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>lib/ChordPro/res/templates/html5/</file>
          <file>t/190_html5_bugfixes.t</file>
        </files>
      </r>
    </item>

    <item id="15" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Strum Pattern Rendering in HTML5</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 15. PDF-specific SVG coordinate system; limited demand.]]></justification>
    </item>

    <item id="16" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>ChordPro Output Backend - Structurization Handling</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 16. Requires unstructured songs; design challenge for ChordProBase.]]></justification>
    </item>

    <item id="18" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>MMA Backend Single-Song Limitation</title>
      <justification><![CDATA[Source: ai-docs/feature-bugs.xml item 18. Limitation inherent to target format.]]></justification>
    </item>

    <item id="19" type="feature" status="DONE" priority="CRITICAL" complexity="M" archived="2026-02-08">
      <title>Paged Mode Activation</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 1.]]></justification>
    </item>

    <item id="20" type="feature" status="DONE" priority="CRITICAL" complexity="M" archived="2026-02-08">
      <title>FormatGenerator Integration (Headers/Footers/Page Numbers)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 2.]]></justification>
    </item>

    <item id="21" type="feature" status="DONE" priority="HIGH" complexity="M" archived="2026-02-08">
      <title>Table of Contents</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 15.]]></justification>
    </item>

    <item id="22" type="feature" status="DONE" priority="MEDIUM" complexity="S" archived="2026-02-08">
      <title>Odd/Even Page Differentiation</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 16.]]></justification>
    </item>

    <item id="23" type="feature" status="DONE" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Songbook Parts (Cover, Front Matter, Back Matter)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 17.]]></justification>
    </item>

    <item id="24" type="feature" status="DONE" priority="LOW" complexity="S" archived="2026-02-08">
      <title>Song Sorting</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 18.]]></justification>
    </item>

    <item id="25" type="feature" status="DONE" priority="HIGH" complexity="M" archived="2026-02-08">
      <title>Chorus Recall (Rechorus)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 3.]]></justification>
    </item>

    <item id="26" type="feature" status="DONE" priority="HIGH" complexity="M" archived="2026-02-08">
      <title>Delegate Support (ABC, LilyPond)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 4.]]></justification>
    </item>

    <item id="27" type="feature" status="DONE" priority="MEDIUM" complexity="S" archived="2026-02-08">
      <title>Annotation Support</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 5.]]></justification>
    </item>

    <item id="28" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Image Alignment and Sizing</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 10.]]></justification>
    </item>

    <item id="29" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Chord Diagram Positioning</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 11.]]></justification>
    </item>

    <item id="30" type="feature" status="DONE" priority="MEDIUM" complexity="S" archived="2026-02-08">
      <title>Chords-Under Mode</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 12.]]></justification>
    </item>

    <item id="31" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Inline Chords Mode</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 13.]]></justification>
    </item>

    <item id="32" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Keyboard Diagram Rendering</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 14.]]></justification>
    </item>

    <item id="33" type="feature" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Comment Box Styling</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 6.]]></justification>
    </item>

    <item id="34" type="feature" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Section Label Display</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 7.]]></justification>
    </item>

    <item id="35" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Grid Bar Lines and Repeat Symbols</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 8.]]></justification>
    </item>

    <item id="36" type="feature" status="DONE" priority="MEDIUM" complexity="M" archived="2026-02-08">
      <title>Volta Brackets</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml feature 9.]]></justification>
    </item>

    <item id="37" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Chords Column (Side Column)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D1.]]></justification>
    </item>

    <item id="38" type="feature" status="DENIED" priority="LOW" complexity="M" archived="2026-02-08">
      <title>Strum Patterns</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D2.]]></justification>
    </item>

    <item id="39" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>PDF Bookmarks/Outlines</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D3.]]></justification>
    </item>

    <item id="40" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>CSV Export (MobileSheets)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D4.]]></justification>
    </item>

    <item id="41" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>Font Embedding (TrueType/OpenType)</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D5.]]></justification>
    </item>

    <item id="42" type="feature" status="DENIED" priority="LOW" complexity="S" archived="2026-02-08">
      <title>Background PDF Page Underlays</title>
      <justification><![CDATA[Source: ai-docs/HTML5_PRINT_Missing_Features.xml denied feature D6.]]></justification>
    </item>

    <item id="43" type="bug" status="DONE" priority="CRITICAL" complexity="S" archived="2026-02-08">
      <title>Chord Alignment When No Leading Chord</title>
      <justification><![CDATA[Source: ai-docs/bugs.xml bug 1.]]></justification>
    </item>

    <item id="44" type="bug" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Images Not Showing in HTML</title>
      <justification><![CDATA[Source: ai-docs/bugs.xml bug 2.]]></justification>
    </item>

    <item id="45" type="bug" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Empty SRC Tags in Image Output</title>
      <justification><![CDATA[Source: ai-docs/bugs.xml bug 3.]]></justification>
    </item>

    <item id="46" type="bug" status="DONE" priority="HIGH" complexity="S" archived="2026-02-08">
      <title>Delegate Output Not Rendering (SVG/ABC)</title>
      <justification><![CDATA[Source: ai-docs/bugs.xml bug 4.]]></justification>
    </item>

    <item id="47" type="bug" status="DONE" priority="MEDIUM" complexity="S" archived="2026-02-08">
      <title>Double-Escaped HTML Entities</title>
      <justification><![CDATA[Source: ai-docs/bugs.xml bug 5.]]></justification>
    </item>
  </archive>

  <changelog>
    <entry date="2026-02-08">Full code analysis refresh; updated overview.xml dependencies and environments.</entry>
    <entry date="2026-02-08">Migrated legacy XML plan files into new schema; archived DONE/DENIED items; created overview.xml.</entry>
  </changelog>
</implementation-plan>