<?xml version="1.0" encoding="UTF-8"?>
<implementation-plan>
  <metadata>
    <title>ChordPro Feature and Bug Plan</title>
    <version>3.1</version>
    <date>2026-02-08</date>
    <updated>2026-02-09</updated>
    <status>Initial code analysis (2026-02-08)</status>
    <summary>
      Initial analysis of the ChordPro codebase. Established architecture, dependencies, and
      feature inventory. Created reference items for incomplete feature mapping and test
      coverage gaps.
    </summary>
  </metadata>

  <items>
    <item id="1" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-1">
      <title>[REF] CLI pipeline mapping and coverage</title>
      <justification><![CDATA[
Core CLI flow is partially mapped. Output selection, filelist parsing, and progress callbacks
are critical paths with limited documented behavior and edge-case coverage.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="1.1"><![CDATA[Map CLI option handling and output backend selection paths.]]></task>
        <task id="1.2"><![CDATA[Document filelist parsing and progress callback behavior.]]></task>
        <task id="1.3"><![CDATA[Add tests for output selection and filelist edge cases.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/10_files.t</file>
            <description>Filelist parsing edge cases.</description>
            <assertions>Filelist parsing matches documented behavior across quoting and options.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="2" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-2">
      <title>[REF] Song parser and directives mapping</title>
      <justification><![CDATA[
Directive coverage is broad but not fully mapped. Edge directives and metadata normalization
behavior need documentation and tests.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="2.1"><![CDATA[Catalog directive handlers and map to element output.]]></task>
        <task id="2.2"><![CDATA[Document metadata normalization and directive precedence.]]></task>
        <task id="2.3"><![CDATA[Add tests for edge directives and mixed metadata cases.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/101_directives.t</file>
            <description>Directive parsing coverage expansion.</description>
            <assertions>Directive outputs match documented element structure.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="3" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-3">
      <title>[REF] Chord parsing and transposition mapping</title>
      <justification><![CDATA[
Chord parsing supports multiple notation systems and transposition rules that are not fully
mapped, increasing regression risk for notation-specific features.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="3.1"><![CDATA[Document chord token parsing and naming conventions.]]></task>
        <task id="3.2"><![CDATA[Map transposition rules and notation-specific conversions.]]></task>
        <task id="3.3"><![CDATA[Add tests for roman, nashville, and solfege edge cases.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/110_chords_roman.t</file>
            <description>Chord notation edge cases.</description>
            <assertions>Notation conversions produce expected symbols and accidentals.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="4" type="refactoring" status="PENDING" priority="LOW" complexity="M" ref-feature="CF-5">
      <title>[REF] Legacy and auxiliary backend parity</title>
      <justification><![CDATA[
Legacy backends vary in feature coverage. Without a parity matrix, regressions are hard to
detect and behavior differences are undocumented.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="4.1"><![CDATA[Inventory element handlers across PDF/HTML/Text/LaTeX/JSON/MMA/ChordPro/Debug/Meta.]]></task>
        <task id="4.2"><![CDATA[Document known gaps and intended behavior differences.]]></task>
        <task id="4.3"><![CDATA[Add baseline tests for at least PDF and Text output.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/100_basic.t</file>
            <description>Baseline backend output checks.</description>
            <assertions>Selected backends render core song elements without errors.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="5" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-6">
      <title>[REF] Markdown backend coverage</title>
      <justification><![CDATA[
Markdown backend handler coverage and representations for diagrams and delegates are not
fully documented or tested.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="5.1"><![CDATA[Audit Markdown handler coverage against ChordProBase elements.]]></task>
        <task id="5.2"><![CDATA[Define representation for diagrams, grids, and delegate outputs.]]></task>
        <task id="5.3"><![CDATA[Add or extend tests for Markdown output coverage.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/73_md.t</file>
            <description>Markdown output coverage tests.</description>
            <assertions>All core elements have valid Markdown representations.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="6" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-7">
      <title>[REF] Chord diagrams and grids mapping</title>
      <justification><![CDATA[
Diagram and grid rendering involve multiple components and font resources. Coverage and
variants (keyboard diagrams, repeats) are only partially mapped.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="6.1"><![CDATA[Map diagram generation flow and SVG rendering paths.]]></task>
        <task id="6.2"><![CDATA[Document grid syntax handling and repeat markers.]]></task>
        <task id="6.3"><![CDATA[Add tests for keyboard diagrams and grid repeats.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/160_diagrams.t</file>
            <description>Diagram rendering coverage.</description>
            <assertions>Diagram outputs match expected SVG or textual format.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="7" type="refactoring" status="PENDING" priority="MEDIUM" complexity="M" ref-feature="CF-8">
      <title>[REF] Delegate integration contracts</title>
      <justification><![CDATA[
Delegate integration relies on external tools and internal IO contracts that are not fully
specified, with minimal automated coverage.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="7.1"><![CDATA[Document delegate input/output contracts and file handling.]]></task>
        <task id="7.2"><![CDATA[Map error handling for missing tools and failed conversions.]]></task>
        <task id="7.3"><![CDATA[Add integration tests for ABC and LilyPond delegates.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="integration">
            <file>t/118_tab.t</file>
            <description>Delegate integration baseline.</description>
            <assertions>Delegates produce renderable output or clear errors.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="8" type="refactoring" status="PENDING" priority="LOW" complexity="M" ref-feature="CF-9">
      <title>[REF] Wx GUI workflow mapping</title>
      <justification><![CDATA[
GUI workflows and state transitions are not fully documented, and automated tests are
uncertain. Mapping reduces regression risk for UI changes.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="8.1"><![CDATA[Document main GUI workflows: open, edit, preview, print.]]></task>
        <task id="8.2"><![CDATA[Map configuration and output settings used by the GUI.]]></task>
        <task id="8.3"><![CDATA[Create a manual test checklist for GUI regression.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="human">
            <file></file>
            <description>Manual GUI regression checklist run.</description>
            <assertions>GUI workflows complete without errors and outputs match CLI behavior.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="9" type="refactoring" status="PENDING" priority="HIGH" complexity="M" ref-feature="CF-10">
      <title>[REF] Configuration system mapping</title>
      <justification><![CDATA[
Config precedence, restricted hashes, and overrides affect most features. The behavior is not
fully documented and lacks dedicated tests.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="9.1"><![CDATA[Document config layering and precedence rules.]]></task>
        <task id="9.2"><![CDATA[Map restricted hash behavior and error cases.]]></task>
        <task id="9.3"><![CDATA[Add tests for override merging and invalid key handling.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/15_subst.t</file>
            <description>Config substitution and override tests.</description>
            <assertions>Overrides apply in correct order and errors are surfaced clearly.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="10" type="refactoring" status="APPROVED" priority="MEDIUM" complexity="M" ref-feature="CF-11">
      <title>[REF] Documentation coverage mapping</title>
      <justification><![CDATA[
Docs site covers core usage but advanced configuration and backend-specific behavior are
incomplete. Mapping gaps helps prioritize documentation work.
]]></justification>
      <depends-on></depends-on>
      <tasks>
        <task id="10.1"><![CDATA[Audit docs coverage against existing features and config keys.]]></task>
        <task id="10.2"><![CDATA[Document backend selection and HTML5 print configuration.]]></task>
        <task id="10.3"><![CDATA[Build docs site and verify new content renders.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="human">
            <file>docs/</file>
            <description>Build docs site with Hugo and review output.</description>
            <assertions>New sections render correctly and navigation is updated.</assertions>
          </test>
        </tests>
      </verification>
    </item>

    <item id="13" type="bug" status="DONE" priority="HIGH" complexity="S" ref-feature="CF-4">
      <title>HTML5 format config access uses redundant eval fallbacks</title>
      <justification><![CDATA[
Default configuration is always loaded first, so HTML5 format entries should exist in the
config tree. Redundant eval-based fallbacks (e.g., eval { $config->{html5} } // {}) can mask
config errors and blur the intended handling of restricted hashes. The HTML5 format generator
should rely on the default config guarantees and only use eval where restricted hashes require
safe access.
]]></justification>
      <depends-on></depends-on>
      <branch>bug/item-13-html5-format-config-access-uses-redundant-eval-fallbacks</branch>
      <tasks>
        <task id="13.1"><![CDATA[Confirm default config guarantees for html5/pdf format keys and how restricted hashes are accessed safely.]]></task>
        <task id="13.2"><![CDATA[Remove redundant eval fallbacks in HTML5 format generation and related config access paths.]]></task>
        <task id="13.3"><![CDATA[Add or update tests/docs to cover HTML5 format generation with default config and restricted hashes.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/190_html5_bugfixes.t</file>
            <description>HTML5 format generator with default config.</description>
            <assertions>Format rules are generated without eval fallbacks and remain correct with restricted hashes.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>Removed eval fallbacks for HTML5 config paths guaranteed by defaults, while keeping guarded access for optional or overridden format keys (including cases where pdf.formats omits default/title/first) and for custom CSS/paged overrides.</observations>
        <lessons-learned>Restricted hashes raise on disallowed keys, so optional or overwritten config keys still require guarded access even when defaults are always loaded.</lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>lib/ChordPro/Output/HTML5Helper/FormatGenerator.pm</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="14" type="refactoring" status="DONE" priority="MEDIUM" complexity="S" ref-feature="CF-4">
      <title>Make HTML5 print mode the default config value</title>
      <justification><![CDATA[
HTML5 output is now commonly used for paged/print workflows. Setting html5.mode default to
"print" aligns the default configuration with the desired output mode and reduces the need
for per-project overrides. This change should update the default config and its generated
Config::Data snapshot, plus any docs or tests that assume "responsive" as the default.
]]></justification>
      <depends-on></depends-on>
      <branch>refactoring/item-14-make-html5-print-mode-default</branch>
      <tasks>
        <task id="14.1"><![CDATA[Update the default html5.mode value in lib/ChordPro/res/config/chordpro.json to "print".]]></task>
        <task id="14.2"><![CDATA[Regenerate lib/ChordPro/Config/Data.pm via script/cfgboot.pl or the standard build step.]]></task>
        <task id="14.3"><![CDATA[Update docs/tests that assume "responsive" is the default HTML5 mode.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/79_html5_oddeven.t</file>
            <description>HTML5 paged mode CSS generation.</description>
            <assertions>Default config uses print mode and paged CSS rules are generated as expected.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>Default HTML5 mode now uses print/paged output, and the generated Config::Data snapshot reflects the new default.</observations>
        <lessons-learned>Regenerating Config::Data.pm also refreshes Config.pod, so documentation artifacts must be tracked alongside config changes.</lessons-learned>
        <files>
          <file>lib/ChordPro/res/config/chordpro.json</file>
          <file>lib/ChordPro/Config/Data.pm</file>
          <file>lib/ChordPro/res/pod/Config.pod</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="15" type="refactoring" status="DONE" priority="MEDIUM" complexity="M" ref-feature="CF-11">
      <title>Update HTML5 configuration docs with full config feature set and examples</title>
      <justification><![CDATA[
The HTML5 configuration guide needs a complete, current inventory of supported settings and
examples so users can configure templates, paged output, CSS customization, and PDF
compatibility without relying on defaults or source code. Updating the documentation reduces
configuration errors and aligns with recent HTML5 backend changes.
]]></justification>
      <depends-on></depends-on>
      <branch>refactoring/item-15-update-html5-configuration-docs</branch>
      <tasks>
        <task id="15.1"><![CDATA[Audit HTML5 configuration keys against lib/ChordPro/res/config/chordpro.json and HTML5 backend usage.]]></task>
        <task id="15.2"><![CDATA[Update docs/content/ChordPro-Configuration-HTML5.md with a complete config feature list and examples.]]></task>
        <task id="15.3"><![CDATA[Call out default behaviors and inheritance rules (html5, html5.paged, pdf fallbacks).]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="human">
            <file>docs/content/ChordPro-Configuration-HTML5.md</file>
            <description>Documentation review for HTML5 configuration completeness.</description>
            <assertions>All supported HTML5 config keys are listed with at least one example per section.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>Added a configuration reference section with full HTML5 key coverage, updated the default mode description, and documented paged overrides and PDF fallbacks.</observations>
        <lessons-learned>Keeping a short reference block near the top makes it easier to reconcile docs with evolving config defaults.</lessons-learned>
        <files>
          <file>docs/content/ChordPro-Configuration-HTML5.md</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="16" type="bug" status="DONE" priority="HIGH" complexity="M" ref-feature="CF-4">
      <title>HTML5 config rejects paged margins and css fonts in user config</title>
      <justification><![CDATA[
Running HTML5 output with a user config fails with "unknown item" errors for
html5.paged.papersize/margins and html5.css.fonts.text, indicating the config schema or
override handling is rejecting valid HTML5 settings. This blocks practical HTML5 print
configuration despite defaults supporting these keys.
]]></justification>
      <depends-on></depends-on>
      <branch>bug/item-16-html5-config-rejects-paged-margins-css-fonts</branch>
      <tasks>
        <task id="16.1"><![CDATA[Reproduce the config errors with the provided command and config file.]]></task>
        <task id="16.2"><![CDATA[Identify why html5.paged.* and html5.css.fonts.* are rejected (schema, merge, or validation path).]]></task>
        <task id="16.3"><![CDATA[Fix config validation/merge so HTML5 paged margins and css fonts are accepted in user configs.]]></task>
        <task id="16.4"><![CDATA[Add regression coverage for html5.paged margins and html5.css.fonts in config overrides.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/210_configs.t</file>
            <description>HTML5 config override acceptance.</description>
            <assertions>html5.paged margins and html5.css.fonts overrides load without unknown-item errors.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>HTML5 override keys now load without unknown-item errors, and paged margin defaults are represented in the base config.</observations>
        <lessons-learned>Allowing free-form CSS override maps requires explicit relaxations in config validation while keeping other keys strict.</lessons-learned>
        <files>
          <file>lib/ChordPro/Config.pm</file>
          <file>lib/ChordPro/res/config/chordpro.json</file>
          <file>lib/ChordPro/Config/Data.pm</file>
          <file>lib/ChordPro/res/pod/Config.pod</file>
          <file>t/210_configs.t</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="17" type="bug" status="IN_PROGRESS" priority="HIGH" complexity="M" ref-feature="CF-7">
      <title>HTML5 chord diagram SVGs expand to full width</title>
      <justification><![CDATA[
In HTML5 paged output, chord diagram SVGs render at full column width instead of the
expected compact size (around 2-3em). The SVGs should have a fixed max width or be
controllable via CSS so diagram size remains consistent and readable in song layouts.
]]></justification>
      <depends-on></depends-on>
      <branch>bug/item-17-html5-chord-diagram-svgs-width</branch>
      <tasks>
        <task id="17.1"><![CDATA[Reproduce the full-width diagram rendering in HTML5 paged output and capture the generated HTML/CSS.]]></task>
        <task id="17.2"><![CDATA[Identify the CSS or template rule responsible for svg sizing in html5 chord diagrams.]]></task>
        <task id="17.3"><![CDATA[Constrain diagram SVG sizing (e.g., max-width in em) or add a configurable CSS variable override.]]></task>
        <task id="17.4"><![CDATA[Add regression coverage for diagram sizing in HTML5 paged output.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/86_html5_diagram_pos.t</file>
            <description>HTML5 chord diagram sizing.</description>
            <assertions>SVG diagrams respect the configured max width and do not expand to full column width.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>PROBLEM</outcome>
        <observations>Added a CSS diagram width variable and included chord diagram styles in the paged CSS template; updated t/86_html5_diagram_pos.t to assert diagram sizing, but the extended test run was interrupted (exit 130) before completion.</observations>
        <lessons-learned>Paged HTML5 output needs explicit inclusion of shared CSS templates to avoid missing sizing rules.</lessons-learned>
        <files>
          <file>lib/ChordPro/res/templates/html5/css/variables.tt</file>
          <file>lib/ChordPro/res/templates/html5/css/chord-diagrams.tt</file>
          <file>lib/ChordPro/res/templates/html5/paged/css/base.tt</file>
          <file>t/86_html5_diagram_pos.t</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="18" type="bug" status="IN_PROGRESS" priority="HIGH" complexity="S" ref-feature="CF-4">
      <title>HTML5 chord-only pairs align with lyrics instead of chord line</title>
      <justification><![CDATA[
When a chord-lyric pair has an empty lyric span (chord-only, e.g., trailing [Am] [Em] at the
end of a line), the HTML5 output aligns the chord with the lyric baseline instead of the
chord line. This misalignment makes chord-only entries drop to the lyric line and disrupts
the chord row alignment.
]]></justification>
      <depends-on></depends-on>
      <branch>bug/item-18-html5-chord-only-align-lyrics</branch>
      <tasks>
        <task id="18.1"><![CDATA[Reproduce chord-only alignment behavior in HTML5 output and capture the HTML/CSS for cp-chord-lyric-pair cp-chord-only.]]></task>
        <task id="18.2"><![CDATA[Identify the CSS/layout rule that aligns chord-only pairs to the lyric baseline instead of the chord line.]]></task>
        <task id="18.3"><![CDATA[Fix chord-only alignment so chords remain on the chord line (e.g., adjust display/vertical-align for cp-chord-only).]]></task>
        <task id="18.4"><![CDATA[Add regression coverage for chord-only alignment in HTML5 output.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/192_html5_chord_only_align.t</file>
            <description>HTML5 chord-only pair alignment.</description>
            <assertions>Chord-only pairs remain aligned with the chord line and do not drop to the lyric baseline.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>PROBLEM</outcome>
        <observations>Added flex-start alignment for chord-only pairs in HTML5 and paged CSS and created t/192_html5_chord_only_align.t; MANIFEST updated, but the extended test run was interrupted (exit 130) before completion.</observations>
        <lessons-learned>Chord-only alignment depends on consistent flex item alignment across both standard and paged CSS templates.</lessons-learned>
        <files>
          <file>lib/ChordPro/res/templates/html5/css/songlines.tt</file>
          <file>lib/ChordPro/res/templates/html5/paged/css/layout.tt</file>
          <file>t/192_html5_chord_only_align.t</file>
          <file>MANIFEST</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

    <item id="19" type="feature" status="IN_PROGRESS" priority="MEDIUM" complexity="M" ref-feature="CF-4">
      <title>HTML5 configurable song page breaks</title>
      <justification><![CDATA[
HTML5 paged output needs a configurable way to force page breaks before or after each song
so users can control song separation in print layouts without manual CSS edits.
]]></justification>
      <depends-on></depends-on>
      <branch>feature/item-19-html5-configurable-song-page-breaks</branch>
      <tasks>
        <task id="19.1"><![CDATA[Define HTML5 config keys for song page breaks (before/after/both/none) and update config schema/defaults.]]></task>
        <task id="19.2"><![CDATA[Apply the config in the HTML5 song wrapper (paged output) with CSS classes or inline styles.]]></task>
        <task id="19.3"><![CDATA[Add or update documentation for the new HTML5 page break setting.]]></task>
        <task id="19.4"><![CDATA[Add regression tests for page-break before/after song rendering in HTML5 paged output.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/94_html5_page_breaks.t</file>
            <description>HTML5 song page-break configuration.</description>
            <assertions>Configured before/after page-breaks appear on the song container in paged output.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>PROBLEM</outcome>
        <observations>Added html5.paged.song.page-break config, song wrapper classes, paged CSS break rules, docs/schema updates, and t/94_html5_page_breaks.t. Standard tests passed, but make tests failed in xt/01_config.t due to missing lib/ChordPro/res/config/chordpro.prp.</observations>
        <lessons-learned>Extended tests depend on generated config property files; ensure chordpro.prp is available before running xt/ tests.</lessons-learned>
        <files>
          <file>lib/ChordPro/res/config/chordpro.json</file>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>lib/ChordPro/res/templates/html5/song.tt</file>
          <file>lib/ChordPro/res/templates/html5/paged/song.tt</file>
          <file>lib/ChordPro/res/templates/html5/paged/css/layout.tt</file>
          <file>lib/ChordPro/res/config/config.schema</file>
          <file>docs/content/ChordPro-Configuration-HTML5.md</file>
          <file>t/94_html5_page_breaks.t</file>
          <file>MANIFEST</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>

  </items>

  <archive>
    <item id="11" type="bug" status="DONE" priority="HIGH" complexity="S" ref-feature="CF-4" archived="2026-02-09">
      <title>HTML5 image alignment regression in t/85_html5_image_align.t</title>
      <justification><![CDATA[
t/85_html5_image_align.t fails subtest 5, indicating a regression in HTML5 image alignment
rendering. This breaks expected HTML5 output formatting.
]]></justification>
      <depends-on></depends-on>
      <branch>bug/item-11-html5-image-alignment-regression</branch>
      <tasks>
        <task id="11.1"><![CDATA[Reproduce t/85_html5_image_align.t subtest 5 failure and capture actual vs expected HTML.]]></task>
        <task id="11.2"><![CDATA[Identify the HTML5 image alignment path (template/CSS/rendering) responsible for the mismatch.]]></task>
        <task id="11.3"><![CDATA[Fix HTML5 image alignment output and add/update regression coverage.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/85_html5_image_align.t</file>
            <description>HTML5 image alignment regression test.</description>
            <assertions>Subtest 5 passes and generated HTML matches expected alignment output.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>Image scaling now preserves explicit width/height attributes when scale is set, which restores the expected HTML5 output.</observations>
        <lessons-learned>Scale handling should not override explicit dimensions when the caller supplies width or height.</lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>
    <item id="12" type="refactoring" status="DONE" priority="MEDIUM" complexity="S" ref-feature="CF-4" archived="2026-02-09">
      <title>[REF] HTML5 image scale behavior alignment</title>
      <justification><![CDATA[
HTML5 image scaling logic and tests diverge on whether scale should override explicit
width/height or only apply when dimensions are omitted. Clarifying and aligning behavior
prevents regressions across HTML5 image tests.
]]></justification>
      <depends-on></depends-on>
      <branch>refactoring/item-12-html5-image-scale-behavior-alignment</branch>
      <tasks>
        <task id="12.1"><![CDATA[Define the intended behavior for width/height combined with scale in HTML5 image rendering.]]></task>
        <task id="12.2"><![CDATA[Update HTML5 image scaling logic to match the intended behavior.]]></task>
        <task id="12.3"><![CDATA[Align HTML5 image scale tests with the updated behavior expectations.]]></task>
      </tasks>
      <verification>
        <tests>
          <test type="unit">
            <file>t/85_html5_image_align.t</file>
            <description>Scale plus explicit width alignment behavior.</description>
            <assertions>Width and scale interactions match the documented behavior.</assertions>
          </test>
          <test type="unit">
            <file>t/190_html5_bug7_image_scale_pagewidth.t</file>
            <description>Scale-only and width+scale behavior.</description>
            <assertions>Scale handling matches expected HTML output for both cases.</assertions>
          </test>
          <test type="unit">
            <file>t/191_html5_image_scale.t</file>
            <description>HTML5 image scale regression coverage.</description>
            <assertions>Scale behavior remains consistent across HTML5 images.</assertions>
          </test>
        </tests>
      </verification>
      <r>
        <outcome>DONE</outcome>
        <observations>HTML5 image scaling now treats scale-only inputs as percentage widths, while width+scale remains a multiplier; the page-width test now exercises scale-only behavior.</observations>
        <lessons-learned>Scale input parsing normalizes percentages to numeric factors, so tests must focus on observable output rather than input syntax.</lessons-learned>
        <files>
          <file>lib/ChordPro/Output/HTML5.pm</file>
          <file>t/190_html5_bug7_image_scale_pagewidth.t</file>
          <file>ai-docs/overview-features-bugs.xml</file>
        </files>
      </r>
    </item>
  </archive>

  <changelog>
    <entry date="2026-02-08">Initial code analysis; generated overview.xml and created 10 [REF] items.</entry>
    <entry date="2026-02-08">Added bug item for HTML5 image alignment regression (t/85_html5_image_align.t).</entry>
    <entry date="2026-02-08">Item 11 implemented. HTML5 image scaling preserves explicit width/height when scale is provided.</entry>
    <entry date="2026-02-08">Added refactoring item to align HTML5 image scale behavior and tests.</entry>
    <entry date="2026-02-08">Item 12 implemented. Aligned HTML5 image scaling logic and tests for scale-only vs width+scale behavior.</entry>
    <entry date="2026-02-09">Archived items 11 and 12.</entry>
    <entry date="2026-02-09">Added bug item for HTML5 format config access and redundant eval fallbacks.</entry>
    <entry date="2026-02-09">Item 13 implemented. Reduced redundant eval access in HTML5 format configuration paths.</entry>
    <entry date="2026-02-09">Added refactoring item to change default HTML5 mode to print.</entry>
    <entry date="2026-02-09">Added refactoring item to update HTML5 configuration documentation.</entry>
    <entry date="2026-02-09">Approved items 14 and 15.</entry>
    <entry date="2026-02-09">Items 14 and 15 implemented. Defaulted HTML5 mode to print and expanded HTML5 configuration documentation.</entry>
    <entry date="2026-02-09">Added bug item for HTML5 config override validation errors in paged margins and CSS fonts.</entry>
    <entry date="2026-02-09">Item 16 implemented. Allowed HTML5 paged margin and CSS font overrides in user config.</entry>
    <entry date="2026-02-09">Added bug item for HTML5 chord diagram SVG sizing in paged output.</entry>
    <entry date="2026-02-09">Added bug item for HTML5 chord-only alignment dropping to lyric baseline.</entry>
    <entry date="2026-02-09">Approved items 17 and 18.</entry>
    <entry date="2026-02-09">Items 17 and 18 implemented. Added diagram sizing variable with paged CSS include and aligned chord-only pairs; added tests, but extended test run was interrupted.</entry>
    <entry date="2026-02-09">Added feature item for configurable HTML5 page breaks before/after songs.</entry>
    <entry date="2026-02-09">Item 19 implemented. Added configurable HTML5 paged song page breaks with template classes, CSS rules, docs, and tests; xt/01_config.t failed due to missing chordpro.prp.</entry>
  </changelog>
</implementation-plan>
